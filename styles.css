/* =========================
   Base Theme
   ========================= */
:root{
  --bg:#0b0c10; --fg:#e6e6e6; --muted:#9aa0a6;
  --card:#11131a; --border:#23252e; --accent:#7aa2f7;
  --radius:12px; --shadow:0 8px 24px rgba(0,0,0,.25);
}

*{box-sizing:border-box}
html,body{
  margin:0;padding:0;background:var(--bg);color:var(--fg);
  font:16px/1.6 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","Hiragino Sans","Microsoft JhengHei",sans-serif;
}
a{color:inherit;text-decoration:none}
.container{max-width:1100px;margin:0 auto;padding:0 20px}

/* =========================
   Header
   ========================= */
.site-header{padding:40px 0 20px}
.site-header h1{margin:0 0 8px;font-size:32px;letter-spacing:.4px}
.subtitle{margin:0 0 8px;color:var(--muted)}
.meta a{margin-right:12px;color:var(--accent)}

/* =========================
   Controls
   ========================= */
.controls{
  display:grid;grid-template-columns:1fr auto;gap:12px;
  margin:12px auto 20px;align-items:center;
}
.filters{display:flex;flex-wrap:wrap;gap:8px}
.btn{
  padding:10px 14px;border:1px solid var(--border);
  background:#0d0f16;border-radius:999px;cursor:pointer;touch-action:manipulation;
}
.btn:hover{border-color:var(--accent)}
.btn.is-checked{background:var(--accent);color:#0c1022;border-color:transparent}
.search-sort{display:flex;gap:8px;align-items:center}
#search,#sort{
  padding:10px 12px;border:1px solid var(--border);
  background:#0d0f16;color:var(--fg);border-radius:10px;min-height:40px;
}

/* =========================
   Masonry Grid (Isotope)
   —— 寬度含間隔整倍數；高度用 padding-top 佔位（穩定）
   ========================= */
.grid{
  position:relative;transition:height .25s ease;padding:4px 0;

  /* PC 預設：4 欄 + 16px 間距 */
  --cols: 4;
  --gut: 16px;

  /* 單欄寬（扣除所有間距後平均分配） */
  --colw: calc((100% - (var(--cols) - 1) * var(--gut)) / var(--cols));

  /* 縮圖基準比例（16:10 → 62.5%） */
  --thumb-pct: 62.5%;
  /* 高度倍數：h2/h3 在此以更高的 padding 百分比實現（穩定、不壓縮） */
  --thumb-pct-h2: 100%;   /* 視覺更高 */
  --thumb-pct-h3: 140%;
}

/* sizer 給 Isotope 讀取 */
.grid-sizer, .grid-item{ width: var(--colw); }
.gutter-sizer{ width: var(--gut); }

/* 垂直間距 = gutter，Isotope 會計入高度 */
.grid-item{
  margin-bottom: var(--gut);
  will-change: transform, opacity;
  transition: transform .18s ease, opacity .18s ease;
}

/* —— 寬度倍數（含中間間隔） —— */
.grid-item--w2{ width: calc(2 * var(--colw) + 1 * var(--gut)); }
.grid-item--w3{ width: calc(3 * var(--colw) + 2 * var(--gut)); }

/* =========================
   Card
   ========================= */
.card{
  background:var(--card);border:1px solid var(--border);
  border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);
  display:flex;flex-direction:column;height:auto;
  transition:transform .2s ease,border-color .2s ease;
}
.card:hover{transform:translateY(-2px);border-color:var(--accent)}

/* 縮圖：用 padding-top 佔位，圖片絕對定位鋪滿（更穩定） */
.thumb{
  position:relative;overflow:hidden;border-radius:12px;box-shadow:var(--shadow);
  /* 骨架動畫（純 CSS） */
  background:linear-gradient(90deg,#14161d 25%,#1b1f2a 50%,#14161d 75%);
  background-size:200% 100%;animation:skeleton 1.1s linear infinite;
}
@keyframes skeleton{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* 基準高度（16:10） */
.thumb::before{
  content:"";display:block;padding-top:var(--thumb-pct);
}
/* 高度倍數（用更高的 padding 百分比） */
.grid-item--h2 .thumb::before{ padding-top: var(--thumb-pct-h2); }
.grid-item--h3 .thumb::before{ padding-top: var(--thumb-pct-h3); }

/* 圖片鋪滿容器，載入後淡入 */
.thumb>img{
  position:absolute;inset:0;width:100%;height:100%;object-fit:cover;
  opacity:0;transition:opacity .25s ease;display:block;
}
.img-loaded{opacity:1}

/* 失敗（不載入外部佔位圖） */
.thumb.is-error::before{
  content:"No Image";display:grid;place-items:center;
  position:absolute;inset:0;color:#9aa0a6;font-size:14px;letter-spacing:.08em;
  background:linear-gradient(180deg,#151823 0%,#11131a 100%);
  border:1px dashed #2a2f3a;border-radius:12px;
}

/* 文字區：固定高度，避免把卡片撐壞（與 PC 設計對齊） */
.card-body{
  flex:0 0 88px; /* 可視覺微調 → 96/104 皆可 */
  padding:14px 14px 12px;
  display:grid;grid-template-rows:auto auto 1fr;row-gap:10px;
}
.card-body h3{
  margin:0;font-size:18px;letter-spacing:.2px;
  display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;
}
.desc{
  margin:0;color:var(--muted);
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
}
.meta-list{
  list-style:none;padding:0;margin:0;
  display:flex;flex-wrap:wrap;gap:10px;color:var(--muted);font-size:13px;
}

/* 類型視覺差異（可視需要微調） */
.grid-item[data-type="project"] .thumb{ /* 可加入微妙遮色片等視覺差異 */ }
.grid-item[data-type="blog"]    .thumb{}

/* =========================
   Article Page (Hero / TOC)
   ========================= */
.post-hero{margin:32px 0 24px}
.post-hero .container{max-width:1100px;margin:0 auto;padding:0 20px}

/* Hero 脫離卡片規則，使用固定高度範圍（不壓縮） */
.post-hero .hero{
  position:relative;overflow:hidden;border-radius:var(--radius);box-shadow:var(--shadow);
  height: clamp(220px, 35vw, 420px);
  background:linear-gradient(90deg,#14161d 25%,#1b1f2a 50%,#14161d 75%);
  background-size:200% 100%;animation:skeleton 1.1s linear infinite;
}
.post-hero .hero>img{
  position:absolute;inset:0;width:100%;height:100%;object-fit:cover;
  opacity:0;transition:opacity .25s ease;display:block;
}
.post-hero .hero>img.img-loaded{opacity:1}

.post-layout{display:grid;gap:24px;grid-template-columns:1fr}
@media (min-width:992px){ .post-layout{grid-template-columns:220px 1fr} }

.post-content{
  background:var(--card);border:1px solid var(--border);
  border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);
}
.post-content img{max-width:100%;height:auto;border-radius:10px}

/* TOC */
.toc{
  position:sticky;top:16px;align-self:start;background:#0d0f16;
  border:1px solid var(--border);border-radius:10px;padding:12px;
}
.toc h3{margin:0 0 8px;font-size:14px;color:var(--muted)}
.toc ul{list-style:none;padding:0;margin:0}
.toc li{margin:6px 0;font-size:14px}
.toc .toc-h2{margin-left:8px}.toc .toc-h3{margin-left:16px}
.toc a{color:var(--accent)}
.back-link{color:var(--accent)}

/* =========================
   Lightbox
   ========================= */
.lightbox{position:fixed;inset:0;display:none}
.lightbox.show{display:block;z-index:9999}
.lightbox-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.8)}
.lightbox-img{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  max-width:92vw;max-height:92vh;border-radius:12px;
}
.lightbox-close{
  position:absolute;top:16px;right:20px;background:transparent;color:#fff;
  border:1px solid rgba(255,255,255,.4);border-radius:999px;font-size:24px;width:40px;height:40px;cursor:pointer;
}

/* =========================
   Footer
   ========================= */
.site-footer{
  padding:48px 0;color:var(--muted);text-align:center;
  border-top:1px solid var(--border);margin-top:40px;
}

/* =========================
   Responsive
   ========================= */
/* 平板：2 欄 / 14px 間距（你要求的 2 欄） */
@media (min-width:720px) and (max-width:1023.98px){
  .grid{
    --cols: 2;
    --gut: 14px;
    --colw: calc((100% - (var(--cols) - 1) * var(--gut)) / var(--cols));
  }
  /* w3 在兩欄不適用，保守處理 */
  .grid-item--w3{ width:100% !important; }
}

/* 手機：1 欄 / 12px 間距（最穩） */
@media (max-width:719.98px){
  .site-header{padding:28px 0 16px}
  .site-header h1{font-size:26px}
  .controls{grid-template-columns:1fr;gap:10px}
  .filters{gap:6px}
  .btn{padding:9px 12px;min-height:40px}
  .search-sort{gap:6px}
  #search{flex:1}
  .post-hero .container{padding:0 14px}
  .post-content{padding:16px}

  .grid{
    --cols: 1;
    --gut: 12px;
    --colw: calc((100% - (var(--cols) - 1) * var(--gut)) / var(--cols));
  }
  .grid-item--w2, .grid-item--w3{ width:100% !important; }
}
