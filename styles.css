:root{
  --bg:#0b0c10; --fg:#e6e6e6; --muted:#9aa0a6;
  --card:#11131a; --border:#23252e; --accent:#7aa2f7;
  --radius:12px; --shadow:0 8px 24px rgba(0,0,0,.25);
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font:16px/1.6 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","Hiragino Sans","Microsoft JhengHei",sans-serif}
a{color:inherit;text-decoration:none}
.container{max-width:1100px;margin:0 auto;padding:0 20px}

/* Header */
.site-header{padding:40px 0 20px}
.site-header h1{margin:0 0 8px;font-size:32px;letter-spacing:.4px}
.subtitle{margin:0 0 8px;color:var(--muted)}
.meta a{margin-right:12px;color:var(--accent)}

/* 控制列 */
.controls{display:grid;grid-template-columns:1fr auto;gap:12px;margin:12px auto 20px;align-items:center}
.filters{display:flex;flex-wrap:wrap;gap:8px}
.btn{padding:10px 14px;border:1px solid var(--border);background:#0d0f16;border-radius:999px;cursor:pointer;touch-action:manipulation}
.btn:hover{border-color:var(--accent)}
.btn.is-checked{background:var(--accent);color:#0c1022;border-color:transparent}
.search-sort{display:flex;gap:8px;align-items:center}
#search,#sort{padding:10px 12px;border:1px solid var(--border);background:#0d0f16;color:var(--fg);border-radius:10px;min-height:40px}

/* Isotope: 使用 .grid-sizer + 百分比欄寬（RWD） */
/* === 計算式 Masonry：欄寬與倍數 === */
.grid {
  position: relative;
  transition: height .25s ease;
  /* 預設（桌面）: 4 欄、16px 間距 */
  --cols: 4;
  --gut: 16px;
  --colw: calc((100% - (var(--cols) - 1) * var(--gut)) / var(--cols));
  padding: 4px 0;
}

/* sizer 交給 Isotope 讀取：列寬與間距 */
.grid-sizer, .grid-item { width: var(--colw); }
.gutter-sizer { width: var(--gut); }

/* 上下間距用倍數（= 水平間距），Isotope 會計入高度 */
.grid-item { margin-bottom: var(--gut); will-change: transform, opacity; }

/* —— 寬度倍數：含中間間隔 —— */
/* w2 = 2 欄 + 1 個間隔；w3 = 3 欄 + 2 個間隔 */
.grid-item--w2 { width: calc(2 * var(--colw) + 1 * var(--gut)); }
.grid-item--w3 { width: calc(3 * var(--colw) + 2 * var(--gut)); }

/* —— 高度倍數：以比例實現（基準 16:10） —— */
.thumb { aspect-ratio: 16 / 10; }
.grid-item--h2 .thumb { aspect-ratio: 16 / 20; } /* 高度×2 */
.grid-item--h3 .thumb { aspect-ratio: 16 / 30; } /* 高度×3 */

/* 類型預設比例（可留著強化視覺差異） */
.grid-item[data-type="project"] .thumb { aspect-ratio: 4 / 3; }
.grid-item[data-type="blog"]    .thumb { aspect-ratio: 16 / 9; }

/* —— 斷點：讓 cols 與 gut 成倍改變，並避免小螢幕超寬 —— */
/* 平板：3 欄、12px */
@media (min-width: 720px) and (max-width: 1023.98px){
  .grid { --cols: 3; --gut: 12px; --colw: calc((100% - (var(--cols) - 1) * var(--gut)) / var(--cols)); }
  /* 兩欄時 w3 會超出，直接收斂 */
  .grid-item--w3 { width: 100% !important; }
}

/* 手機：2 欄、12px（或想更穩可改成 1 欄，見下個 media） */
@media (max-width: 719.98px){
  .grid { --cols: 2; --gut: 12px; --colw: calc((100% - (var(--cols) - 1) * var(--gut)) / var(--cols)); }
  /* cols=2 時，w2 公式剛好 = 100%（2*colw + 1*gut = 100%），OK；
     w3 不存在，強制收斂。 */
  .grid-item--w3 { width: 100% !important; }
}

/* 若你想在最小螢幕完全保險：改成 1 欄、12px（擇一） */
@media (max-width: 479.98px){
  .grid { --cols: 1; --gut: 12px; --colw: calc((100% - (var(--cols) - 1) * var(--gut)) / var(--cols)); }
  .grid-item--w2, .grid-item--w3 { width: 100% !important; }
}
/* 其他樣式保持不變（card/thumb/hero…） */

/* 卡片 */
.card{display:block;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);transition:transform .2s ease,border-color .2s ease}
.card:hover{transform:translateY(-2px);border-color:var(--accent)}
.card-body{padding:14px 14px 12px}
.card-body h3{margin:0 0 6px;font-size:18px;letter-spacing:.2px}
.desc{margin:0 0 10px;color:var(--muted)}
.meta-list{list-style:none;padding:0;margin:0;display:flex;flex-wrap:wrap;gap:10px;color:var(--muted);font-size:13px}


/* 圖片容器：純 CSS 骨架（不使用任何佔位圖） */
.thumb,.hero{
  position:relative;overflow:hidden;border-radius:12px;box-shadow:var(--shadow);
  aspect-ratio:16/9; /* hero 會覆蓋比例 */
  background:linear-gradient(90deg,#14161d 25%,#1b1f2a 50%,#14161d 75%);
  background-size:200% 100%;animation:skeleton 1.1s linear infinite;
}
.hero{ aspect-ratio:21/9 } /* 題圖更寬的視覺 */
@keyframes skeleton{0%{background-position:200% 0}100%{background-position:-200% 0}}

.thumb>img,.hero>img{
  position:absolute;inset:0;width:100%;height:100%;object-fit:cover;
  opacity:0;transition:opacity .25s ease;display:block;
}
.img-loaded{opacity:1}    /* JS 在 load 時加上，淡入 */

/* 失敗時（JS 僅加上 .is-error，不用任何圖片） */
.thumb.is-error::before,.hero.is-error::before{
  content:"No Image";
  position:absolute;inset:0;display:grid;place-items:center;
  color:#9aa0a6;font-size:14px;letter-spacing:.08em;
  background:linear-gradient(180deg,#151823 0%,#11131a 100%);
  border:1px dashed #2a2f3a;border-radius:12px;
}

/* 文章頁 */
.post-hero{margin:32px 0 24px}
.post-hero .container{max-width:1100px;margin:0 auto;padding:0 20px}
.post-layout{display:grid;gap:24px;grid-template-columns:1fr}
@media (min-width:992px){.post-layout{grid-template-columns:220px 1fr}}
.post-content{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow)}
.post-content img{max-width:100%;height:auto;border-radius:10px}

/* TOC */
.toc{position:sticky;top:16px;align-self:start;background:#0d0f16;border:1px solid var(--border);border-radius:10px;padding:12px}
.toc h3{margin:0 0 8px;font-size:14px;color:var(--muted)}
.toc ul{list-style:none;padding:0;margin:0}
.toc li{margin:6px 0;font-size:14px}
.toc .toc-h2{margin-left:8px}.toc .toc-h3{margin-left:16px}
.toc a{color:var(--accent)}
.back-link{color:var(--accent)}

/* Lightbox */
.lightbox{position:fixed;inset:0;display:none}
.lightbox.show{display:block;z-index:9999}
.lightbox-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.8)}
.lightbox-img{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);max-width:92vw;max-height:92vh;border-radius:12px}
.lightbox-close{position:absolute;top:16px;right:20px;background:transparent;color:#fff;border:1px solid rgba(255,255,255,.4);border-radius:999px;font-size:24px;width:40px;height:40px;cursor:pointer}

/* Footer */
.site-footer{padding:48px 0;color:var(--muted);text-align:center;border-top:1px solid var(--border);margin-top:40px}

/* 手機優化 */
@media (max-width:640px){
  .site-header{padding:28px 0 16px}
  .site-header h1{font-size:26px}
  .controls{grid-template-columns:1fr;gap:10px}
  .filters{gap:6px}
  .btn{padding:9px 12px;min-height:40px}
  .search-sort{gap:6px}
  #search{flex:1}
  .post-hero .container{padding:0 14px}
  .post-content{padding:16px}
}
/* 手機：單欄填滿，沒有空缺 */
@media (max-width: 719.98px){
  .grid-sizer, .grid-item { width: 100%; }
  .gutter-sizer { width: 12px; }               /* 保留一點水平間距 */
  .grid-item--w2, .grid-item--w3 { width: 100% !important; } /* 禁用寬變體 */
}

/* 平板：兩欄；同樣禁用寬變體避免洞 */
@media (min-width: 720px) and (max-width: 1023.98px){
  .grid-sizer, .grid-item { width: 50%; }
  .gutter-sizer { width: 12px; }
  .grid-item--w2, .grid-item--w3 { width: 100% !important; }
}
