/* ===== Theme & Base ===== */
:root{
  --bg:#0b0c10; --fg:#e6e6e6; --muted:#9aa0a6;
  --card:#11131a; --border:#23252e; --accent:#7aa2f7;
  --radius:12px; --shadow:0 8px 24px rgba(0,0,0,.25);
  --gut:16px;
}
*{box-sizing:border-box}
html,body{
  margin:0; padding:0; background:var(--bg); color:var(--fg);
  font:16px/1.6 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","Hiragino Sans","Microsoft JhengHei",sans-serif;
}
a{color:inherit; text-decoration:none}
.container{max-width:1100px; margin:0 auto; padding:0 20px}

/* ===== Header & Controls ===== */
.site-header{padding:40px 0 20px}
.site-header h1{margin:0 0 8px; font-size:32px; letter-spacing:.4px}
.subtitle{margin:0 0 8px; color:var(--muted)}
.meta a{margin-right:12px; color:var(--accent)}

.controls{
  display:grid; grid-template-columns:1fr auto; gap:12px;
  margin:12px auto 20px; align-items:center;
}
.filters{display:flex; flex-wrap:wrap; gap:8px}
.btn{
  padding:10px 14px; border:1px solid var(--border);
  background:#0d0f16; border-radius:999px; cursor:pointer;
}
.btn:hover{border-color:var(--accent)}
.btn.is-checked{background:var(--accent); color:#0c1022; border-color:transparent}
.search-sort{display:flex; gap:8px; align-items:center}
#search,#sort{
  padding:10px 12px; border:1px solid var(--border);
  background:#0d0f16; color:var(--fg); border-radius:10px; min-height:40px;
}

/* ===== Masonry (Isotope) — width as multiples incl. gutter ===== */
.grid{
  position:relative; transition:height .25s ease; padding:4px 0;

  /* default (desktop) */
  --cols: 4;            /* columns */
  --gut: 16px;          /* gutter */
  --colw: calc((100% - (var(--cols) - 1) * var(--gut)) / var(--cols));
  --thumb-pct: 62.5%;   /* 16:10 base ratio */
  --thumb-pct-h2: 100%; /* taller variations */
  --thumb-pct-h3: 140%;
}
.grid-sizer, .grid-item{ width: var(--colw); }
.gutter-sizer{ width: var(--gut); }
.grid-item{ margin-bottom: var(--gut); will-change: transform, opacity; transition: transform .18s ease, opacity .18s ease; }

/* width multiples (include inner gutters) */
.grid-item--w2{ width: calc(2 * var(--colw) + 1 * var(--gut)); }
.grid-item--w3{ width: calc(3 * var(--colw) + 2 * var(--gut)); }

/* ===== Card & Thumb (padding-top placeholders) ===== */
.card{
  background:var(--card); border:1px solid var(--border);
  border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow);
  display:flex; flex-direction:column; transition:transform .2s ease,border-color .2s ease;
}
.card:hover{transform:translateY(-2px); border-color:var(--accent)}

.thumb{
  position:relative; overflow:hidden; border-radius:12px; box-shadow:var(--shadow);
  background:linear-gradient(90deg,#14161d 25%,#1b1f2a 50%,#14161d 75%);
  background-size:200% 100%; animation:skeleton 1.1s linear infinite;
}
@keyframes skeleton{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* base height */
.thumb::before{ content:""; display:block; padding-top: var(--thumb-pct); position:relative; z-index:0; }
/* taller variants */
.grid-item--h2 .thumb::before{ padding-top: var(--thumb-pct-h2); }
.grid-item--h3 .thumb::before{ padding-top: var(--thumb-pct-h3); }

/* image layering & fade-in */
.thumb > img{
  position:absolute; inset:0; width:100%; height:100%;
  object-fit:cover; display:block; opacity:0; transition:opacity .25s ease; z-index:1;
}
.thumb > img.img-loaded{ opacity:1 !important; }

/* skeleton off when loaded; error overlay */
.thumb.is-loaded{ background:none; animation:none; }
.thumb.is-error::before{
  content:"No Image"; position:absolute; inset:0; z-index:2; display:grid; place-items:center;
  color:#9aa0a6; font-size:14px; letter-spacing:.08em;
  background:linear-gradient(180deg,#151823 0%,#11131a 100%); border:1px dashed #2a2f3a; border-radius:12px;
}

/* text area (fixed height keeps cards tidy) */
.card-body{
  flex:0 0 88px; padding:14px 14px 12px;
  display:grid; grid-template-rows:auto auto 1fr; row-gap:10px;
}
.card-body h3{
  margin:0; font-size:18px; letter-spacing:.2px;
  display:-webkit-box; -webkit-line-clamp:1; -webkit-box-orient:vertical; overflow:hidden;
}
.desc{
  margin:0; color:var(--muted);
  display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
}
.meta-list{
  list-style:none; padding:0; margin:0;
  display:flex; flex-wrap:wrap; gap:10px; color:var(--muted); font-size:13px;
}

/* ===== Article Page (Hero separated) ===== */
.post-hero{margin:32px 0 24px}
.post-hero .container{max-width:1100px; margin:0 auto; padding:0 20px}
.post-hero .hero{
  position:relative; overflow:hidden; border-radius:var(--radius); box-shadow:var(--shadow);
  height: clamp(220px, 35vw, 420px);
  background:linear-gradient(90deg,#14161d 25%,#1b1f2a 50%,#14161d 75%);
  background-size:200% 100%; animation:skeleton 1.1s linear infinite;
}
.post-hero .hero>img{
  position:absolute; inset:0; width:100%; height:100%; object-fit:cover;
  display:block; opacity:0; transition:opacity .25s ease;
}
.post-hero .hero>img.img-loaded{opacity:1}
.post-hero .hero.is-loaded{ background:none; animation:none; }

.post-layout{display:grid; gap:24px; grid-template-columns:1fr}
@media (min-width:992px){ .post-layout{grid-template-columns:220px 1fr} }
.post-content{
  background:var(--card); border:1px solid var(--border);
  border-radius:var(--radius); padding:20px; box-shadow:var(--shadow);
}
.post-content img{max-width:100%; height:auto; border-radius:10px}

/* ===== Lightbox (可選) ===== */
.lightbox{position:fixed; inset:0; display:none}
.lightbox.show{display:block; z-index:9999}
.lightbox-backdrop{position:absolute; inset:0; background:rgba(0,0,0,.8)}
.lightbox-img{position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); max-width:92vw; max-height:92vh; border-radius:12px}
.lightbox-close{position:absolute; top:16px; right:20px; background:transparent; color:#fff; border:1px solid rgba(255,255,255,.4); border-radius:999px; font-size:24px; width:40px; height:40px; cursor:pointer}

/* ===== Footer ===== */
.site-footer{
  padding:48px 0; color:var(--muted); text-align:center;
  border-top:1px solid var(--border); margin-top:40px;
}

/* ===== Responsive ===== */
/* Tablet: 2 cols / 14px gutter */
@media (min-width:720px) and (max-width:1023.98px){
  .grid{
    --cols: 2; --gut: 14px;
    --colw: calc((100% - (var(--cols) - 1) * var(--gut)) / var(--cols));
  }
  .grid-item--w3{ width:100%; }
}
/* Mobile: 1 col / 12px gutter */
@media (max-width:719.98px){
  .site-header{padding:28px 0 16px}
  .site-header h1{font-size:26px}
  .controls{grid-template-columns:1fr; gap:10px}
  .filters{gap:6px}
  .btn{padding:9px 12px; min-height:40px}
  .search-sort{gap:6px}
  #search{flex:1}
  .post-hero .container{padding:0 14px}
  .post-content{padding:16px}

  .grid{
    --cols: 1; --gut: 12px;
    --colw: calc((100% - (var(--cols) - 1) * var(--gut)) / var(--cols));
  }
  .grid-item--w2, .grid-item--w3{ width:100%; }
}

/* 動畫減少偏好 */
@media (prefers-reduced-motion: reduce){
  .thumb, .post-hero .hero{ animation:none }
}

/* ===== Performance Tweaks ===== */

/* 版面基本值：可留 */
:root{
  --gut: 16px;
}
*{box-sizing:border-box}
html{scrollbar-gutter: stable both-edges;} /* 捲軸寬固定，避免左右抖 */
.grid{position:relative; /* 很重要：不要對 height 做動畫 */ }

/* sizer / gutter 交給 Isotope */
.grid-sizer{ width: calc((100% - 3 * var(--gut)) / 4); } /* 4欄示例 */
.gutter-sizer{ width: var(--gut); }

/* item 必須絕對定位（Isotope 會設），這裡只定義動畫 */
.grid-item{
  /* 你自己的外觀樣式可保留（卡片、陰影、邊框之類） */
}

/* ✅ 只動畫 transform（位移）+ 輕微透明度；不要寫 scale */
.isotope-item{
  transition:
    transform 150ms cubic-bezier(.2,.6,.2,1),
    opacity   150ms ease;
  will-change: transform, opacity;
  backface-visibility: hidden;
  transform: translateZ(0);
}

/* （可選）偏好減少動畫者關掉 */
@media (prefers-reduced-motion: reduce){
  .isotope-item{ transition: none !important; }
}

/* RWD：示例（3 欄/2 欄），保持 sizer/gutter 是唯一寬度來源 */
@media (max-width: 1023.98px){
  .grid-sizer{ width: calc((100% - 2 * var(--gut)) / 3); }
}
@media (max-width: 719.98px){
  .grid-sizer{ width: calc((100% - 1 * var(--gut)) / 2); }
}
